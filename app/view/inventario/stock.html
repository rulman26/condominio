<div class="form-cliente">
  <div class="form-cabecera">
    <h4>Stock de Productos</h4>
  </div> 
  <hr>
  <div class="container-fluid">    
    <datalist id="item_list">
    </datalist>
    <div class="row">
      <div class="col-md-2">
        <div class="input-group">      
          <input type="hidden" id="item_id" name="item_id">            
          <input required type="text" class="form-control" list="item_list" id="item_nombre" 
            name="item_nombre" onchange="id_item(this)" placeholder="Nombre Item">
        </div>
      </div>
      <div class="col-sm-2">
          <div class="input-group">
            <select class="form-control" id="proveedor_id" name="proveedor_id">
            </select>
          </div>
      </div>
      <div class="col-sm-2">
          <div class="input-group">
            <select class="form-control" id="item_tipo_id" name="item_tipo_id">
            </select>
          </div>
      </div>
      <div class="col-sm-2">
          <div class="input-group">
              <select class="form-control" id="item_categoria_id" name="item_categoria_id">
                </select>
          </div>
      </div>
      <div class="col-sm-2">
          <div class="input-group">
            <button class="btn btn-primary btn-block" onclick="stockListar()">Buscar</button>
          </div>
      </div>
      <div class="col-sm-2" id="div_buscar" style="display: none">
        <div class="input-group">
          <input type="text" class="form-control" id="txt_buscar" onkeyup="BuscarFilaTabla('tabla_http','txt_buscar')" placeholder="Filtar Datos">
          <div class="input-group-prepend">        
            <span class="input-group-text" data-toggle="dropdown"><i class="fas fa-ellipsis-v"></i></span>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="javascript:void(0)" onclick="exportarIngresosCsv()">Exportar CVS</a>
              <a class="dropdown-item" href="javascript:void(0)" onclick="exportarIngresosPdf()">Exportar PDF</a>          
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive" id="tabla_http_scroll">
      <table class="table table-hover" id="tabla_http">
        <thead>
        <th width="50">Id</th>          
        <th width="200">Item</th>
        <th width="150">Ingreso</th>
        <th width="150">Fabricacion</th>
        <th width="150">Vencimiento</th>                    
        <th width="100">cantidad</th>          
        <th width="100">Saldo</th>          
        </tr>
        </thead>
        <tbody>
        </tbody>
      </table>
    </div>
  </div>
</div>    
<script type="text/javascript">
function list_items(){
  $.get(baseUrl+"item/forminventario",function(data){
    let response=JSON.parse(data); 
    console.log(response)	
    let fila;
    let items=response.items;
    for (x in items) {	  	  	
      fila+='<option codigo="'+items[x].ITEM_ID+'" value="'+items[x].ITEM_NOMBRE+'"/>';	  	  
    }  
    $("#item_list").html(fila);
  });
}
list_items();

function datosFormItemRegistrar(){  
  $.get(baseUrl+"item/formitemregistrar",function(data){      
    let response=JSON.parse(data);    
    console.log(response);
    let selectProveedor=document.getElementById("proveedor_id");
    let proveedoresOptions='<option value="">Todos</option>';
    let proveedores=response.proveedores;    
    for(x in proveedores){
      proveedoresOptions+='<option value="'+proveedores[x].PROVEEDOR_ID+'">'+proveedores[x].PROVEEDOR_NOMBRE+'</option>';
    }    
    selectProveedor.innerHTML=proveedoresOptions;

    let selectItemTipo=document.getElementById("item_tipo_id");
    let ItemTipoOptions='<option value="">Todos</option>';
    let itemtipos=response.itemtipos;    
    for(x in itemtipos){
      ItemTipoOptions+='<option value="'+itemtipos[x].ITEM_TIPO_ID+'">'+itemtipos[x].ITEM_TIPO_NOMBRE+'</option>';
    }    
    selectItemTipo.innerHTML=ItemTipoOptions;

    let selectItemCategoria=document.getElementById("item_categoria_id");
    let ItemCategoriaOptions='<option value="">Todos</option>';
    let itemcategorias=response.itemcategorias;    
    for(x in itemcategorias){
      ItemCategoriaOptions+='<option value="'+itemcategorias[x].ITEM_CATEGORIA_ID+'">'+itemcategorias[x].ITEM_CATEGORIA_NOMBRE+'</option>';
    }    
    selectItemCategoria.innerHTML=ItemCategoriaOptions;
  });     
}

datosFormItemRegistrar();

function id_item(input){         	 
  list = document.getElementById('item_list').options;
  let m_item_id=document.getElementById('item_id');
	for(x in list){      		
		if (list[x].value==input.value) {			
			let item_id=list[x].getAttribute('codigo');	      
      m_item_id.value=item_id;      
			break;
		}     		
	}
}
var stocks=[];
function stockListar(){
  let data={};
  data['item_id']=document.getElementById("item_id").value;
  data['proveedor_id']=document.getElementById("proveedor_id").value;
  data['item_tipo_id']=document.getElementById("item_tipo_id").value;
  data['item_categoria_id']=document.getElementById("item_categoria_id").value;
  console.log(data);
  $("#tabla_http tbody").html('<td colspan="5" class="table-loader-td"><img class="table-loader" src="img/cargando_modal.gif"><td>');    
  $.post(baseUrl+"inventario/stock",data,function(data){
    $("#tabla_http tbody").html("");      
    let response=JSON.parse(data);        
    console.log(response);
    if (response.estado) {
      for (x in response['stock']) {
        stocks[response['stock'][x].INVENTARIO_ID]=response['stock'][x];         
        let fila='<tr>';      
        fila+='<td>'+response['stock'][x].INVENTARIO_ID+'</td>';  
        fila+='<td>'+response['stock'][x].ITEM_NOMBRE+'</td>';
        fila+='<td>'+response['stock'][x].FECHA_INGRESO+'</td>';
        fila+='<td>'+response['stock'][x].FECHA_FABRICACION+'</td>';
        fila+='<td>'+response['stock'][x].FECHA_VENCIMIENTO+'</td>';          
        fila+='<td>'+response['stock'][x].INVENTARIO_CANTIDAD+'</td>';        
        fila+='<td>'+response['stock'][x].INVENTARIO_SALDO+'</td>';                     
        fila+='</tr>';
        $("#tabla_http tbody").append(fila);
      }
    }else{
      let modal_conten_loader=modalRespuestaError('Error',response.mensaje,'');        
      $('#modal_mensaje').html(modal_conten_loader);
      $('#modal_mensaje').modal('toggle'); 
    }    
  });

}
</script>  